<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Entry</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            width: 600px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            position: relative;
        }
        .logo {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 36px;
            font-weight: bold;
            color: #009999;
        }
        h1 {
            text-align: center;
            color: #009999;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-group button {
            width: auto;
            background-color: #007BFF;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        .form-group button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        .action-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .action-buttons button {
            margin-right: 10px;
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            color: #fff;
            font-size: 0.8em;
        }
        .action-buttons #generate-inventory-file {
            background-color: #28a745;
        }
        .action-buttons #generate-inventory-file:hover {
            background-color: #218838;
        }
        .action-buttons #preview-inventory-file {
            background-color: #17a2b8;
        }
        .action-buttons #preview-inventory-file:hover {
            background-color: #138496;
        }
        #files-table {
            margin-top: 20px;
            width: 100%;
        }
        #files-table th, #files-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        #files-table button {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            color: #fff;
        }
        #files-table .download-file {
            background-color: #007BFF;
        }
        #files-table .delete-file {
            background-color: #DC3545;
        }
        .bold {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">SIEMENS</div>
        <h1>Inventory Entry</h1>
        <form id="inventory-entry-form">
            <div class="form-group">
                <label for="polarity">Polarity</label>
                <select id="polarity">
                    <option value="1P">1P</option>
                    <option value="2P">2P</option>
                    <option value="3P">3P</option>
                    <option value="4P">4P</option>
                </select>
            </div>
            <div class="form-group">
                <label for="rating">Rating</label>
                <select id="rating">
                    <option value="0.5A">0.5A</option>
                    <option value="1A">1A</option>
                    <option value="2A">2A</option>
                    <option value="3A">3A</option>
                    <option value="4A">4A</option>
                    <option value="6A">6A</option>
                    <option value="8A">8A</option>
                    <option value="10A">10A</option>
                    <option value="13A">13A</option>
                    <option value="16A">16A</option>
                    <option value="20A">20A</option>
                    <option value="25A">25A</option>
                    <option value="32A">32A</option>
                    <option value="40A">40A</option>
                    <option value="50A">50A</option>
                    <option value="63A">63A</option>
                    <option value="70A">70A</option>
                    <option value="80A">80A</option>
                </select>
            </div>
            <div class="form-group">
                <label for="product-family">Product Family</label>
                <select id="product-family">
                    <option value="5SL1">5SL1</option>
                    <option value="5SJ">5SJ</option>
                    <option value="Mexico">Mexico</option>
                    <option value="5SL6">5SL6</option>
                    <option value="5SL4">5SL4</option>
                    <option value="ELSA-2">ELSA-2</option>
                    <option value="ELSA-1">ELSA-1</option>
                    <option value="5SL7">5SL7</option>
                    <option value="K">K</option>
                    <option value="MB">MB</option>
                    <option value="MB Europe">MB Europe</option>
                    <option value="5SL7-K">5SL7-K</option>
                </select>
            </div>
            <div class="form-group">
                <label for="breaking-capacity">Breaking Capacity</label>
                <select id="breaking-capacity">
                    <!-- Options will be dynamically populated based on Product Family selection -->
                </select>
            </div>
            <div class="form-group">
                <label for="quantity">Quantity</label>
                <input type="number" id="quantity" min="1">
            </div>
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location">
            </div>
            <button type="button" id="add-entry">Add Entry</button>
        </form>
        <table id="entry-table">
            <thead>
                <tr>
                    <th>Polarity</th>
                    <th>Rating</th>
                    <th>Product Family</th>
                    <th>Breaking Capacity</th>
                    <th>Quantity</th>
                    <th>Location</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="action-buttons">
            <button type="button" id="preview-inventory-file">Preview Inventory File</button>
            <button type="button" id="generate-inventory-file" style="display: none;">Generate Inventory File</button>
        </div>
    </div>
    <script>
        const breakingCapacityData = {
            '5SL1': ['3KA'],
            '5SJ': ['6KA'],
            'Mexico': ['4.5/6KA'],
            '5SL6': ['7.5KA'],
            '5SL4': ['10KA'],
            'ELSA-2': ['10kA/15kA/20kA'],
            'ELSA-1': ['6KA'],
            '5SL7': ['15KA'],
            'K': ['15KA'],
            'MB': ['7.5KA/10KA'],
            'MB Europe': ['7.5KA/10KA'],
            '5SL7-K': ['15KA']
        };

        const productFamilySelect = document.getElementById('product-family');
        const breakingCapacitySelect = document.getElementById('breaking-capacity');
        const polaritySelect = document.getElementById('polarity');
        const ratingSelect = document.getElementById('rating');
        const quantityInput = document.getElementById('quantity');
        const locationInput = document.getElementById('location');
        const entryTableBody = document.getElementById('entry-table').querySelector('tbody');
        const previewInventoryFileButton = document.getElementById('preview-inventory-file');
        const generateInventoryFileButton = document.getElementById('generate-inventory-file');
        const allEntries = [];

        productFamilySelect.addEventListener('change', () => {
            const selectedFamily = productFamilySelect.value;
            const capacities = breakingCapacityData[selectedFamily] || [];
            breakingCapacitySelect.innerHTML = '';
            capacities.forEach(capacity => {
                const option = document.createElement('option');
                option.value = capacity;
                option.textContent = capacity;
                breakingCapacitySelect.appendChild(option);
            });
        });

        document.getElementById('add-entry').addEventListener('click', () => {
            const polarity = polaritySelect.value;
            const rating = ratingSelect.value;
            const productFamily = productFamilySelect.value;
            const breakingCapacity = breakingCapacitySelect.value;
            const quantity = quantityInput.value;
            const location = locationInput.value;

            if (!polarity || !rating || !productFamily || !breakingCapacity || !quantity || !location) {
                alert('Please fill all fields before adding entry.');
                return;
            }

            const entry = { polarity, rating, productFamily, breakingCapacity, quantity, location };
            allEntries.push(entry);

            displayEntries();

            polaritySelect.value = '';
            ratingSelect.value = '';
            productFamilySelect.value = '';
            breakingCapacitySelect.innerHTML = '';
            quantityInput.value = '';
            locationInput.value = '';
        });

        function displayEntries() {
            entryTableBody.innerHTML = '';
            allEntries.forEach((entry, index) => {
                const row = document.createElement('tr');
                if (index === allEntries.length - 1) {
                    row.classList.add('bold');
                }
                row.innerHTML = `<td>${entry.polarity}</td><td>${entry.rating}</td><td>${entry.productFamily}</td><td>${entry.breakingCapacity}</td><td>${entry.quantity}</td><td>${entry.location}</td>`;
                entryTableBody.appendChild(row);
            });
        }

        previewInventoryFileButton.addEventListener('click', () => {
            if (allEntries.length === 0) {
                alert('No entries to preview.');
                return;
            }
            displayEntries();
            generateInventoryFileButton.style.display = 'inline-block';
        });

        generateInventoryFileButton.addEventListener('click', () => {
            const fileName = prompt('Please enter the file name:');
            if (!fileName) {
                alert('File name is required.');
                return;
            }

            const csvHeader = "Polarity,Rating,Product Family,Breaking Capacity,Quantity,Location";
            const csvRows = allEntries.map(entry => `${entry.polarity},${entry.rating},${entry.productFamily},${entry.breakingCapacity},${entry.quantity},${entry.location}`);
            const csvContent = `data:text/csv;charset=utf-8,${csvHeader}\n${csvRows.join('\n')}`;
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `${fileName}.csv`);
            document.body.appendChild(link);
            link.click();
            const storedFiles = JSON.parse(localStorage.getItem('generatedFiles')) || [];
            storedFiles.push({ name: `${fileName}.csv`, content: csvContent });
            localStorage.setItem('generatedFiles', JSON.stringify(storedFiles));
            window.location.href = 'physical-counting.html';
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderFiles();
        });
    </script>
</body>
</html>
